import{S as u}from"./sweetalert2.all-24826e54.js";import{m as D,D as $}from"./DelModal-01ca8c25.js";import{_ as g,o as d,c as a,b as o,A as c,B as m,X as I,t as C,d as _,w as V,F as v,j as B,r as h,p as N,f as T}from"./index-f0e198c8.js";import{P as U}from"./PaginationView-9c594604.js";const A={props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!1}},data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon;const n=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=n},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[D]},E={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},P={class:"modal-dialog",role:"document"},S={class:"modal-content"},O={class:"modal-header"},j={class:"modal-title",id:"exampleModalLabel"},R={key:0},F={key:1},H=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G={class:"modal-body"},X={class:"mb-3"},q=o("label",{for:"title"},"標題",-1),z={class:"mb-3"},J=o("label",{for:"coupon_code"},"優惠碼",-1),K={class:"mb-3"},Q=o("label",{for:"due_date"},"到期日",-1),W={class:"mb-3"},Y=o("label",{for:"price"},"折扣百分比",-1),Z={class:"mb-3"},oo={class:"form-check"},to=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),eo={class:"modal-footer"},no=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1);function so(n,t,p,r,e,i){return d(),a("div",E,[o("div",P,[o("div",S,[o("div",O,[o("h5",j,[p.isNew?(d(),a("span",R,"新增優惠卷")):(d(),a("span",F,"編輯優惠卷"))]),H]),o("div",G,[o("div",X,[q,c(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=s=>e.tempCoupon.title=s),placeholder:"請輸入標題"},null,512),[[m,e.tempCoupon.title]])]),o("div",z,[J,c(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=s=>e.tempCoupon.code=s),placeholder:"請輸入優惠碼"},null,512),[[m,e.tempCoupon.code]])]),o("div",K,[Q,c(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=s=>e.due_date=s)},null,512),[[m,e.due_date]])]),o("div",W,[Y,c(o("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[3]||(t[3]=s=>e.tempCoupon.percent=s),placeholder:"請輸入折扣百分比"},null,512),[[m,e.tempCoupon.percent,void 0,{number:!0}]])]),o("div",Z,[o("div",oo,[c(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=s=>e.tempCoupon.is_enabled=s),id:"is_enabled"},null,512),[[I,e.tempCoupon.is_enabled]]),to])])]),o("div",eo,[no,o("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=s=>n.$emit("update-coupon",e.tempCoupon))},C(p.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const io=g(A,[["render",so]]);const{VITE_URL:f,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"kevin-jiang",BASE_URL:"/finalweek/",MODE:"production",DEV:!1,PROD:!0},lo={components:{CouponModal:io,DelModal:$,Pagination:U},props:{config:Object},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},pages:{},isLoading:!1,isNew:!1}},methods:{getCoupons(){this.isLoading=!0,this.$http.get(`${f}/api/${b}/admin/coupons`,this.tempProduct).then(n=>{this.coupons=n.data.coupons,this.pages=n.data.pagination,this.isLoading=!1}).catch(()=>{this.isLoading=!1,u.fire({position:"top-end",icon:"error",title:"資料取得失敗(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0})})},openCouponModal(n,t){this.isNew=n,this.isNew?this.tempCoupon={due_date:new Date().getTime()/1e3}:this.tempCoupon={...t},this.$refs.couponModal.openModal()},openDelCouponModal(n){this.tempCoupon={...n},this.$refs.delModal.openModal()},updateCoupon(n){this.isLoading=!0;let t=`${f}/api/${b}/admin/coupon`,p="post",r=n,e="新增優惠券成功d(`･∀･)b",i="新增優惠券失敗٩(ŏ﹏ŏ、)۶";this.isNew||(t=`${f}/api/${b}/admin/coupon/${this.tempCoupon.id}`,p="put",r=this.tempCoupon,e="修改優惠券成功d(`･∀･)b",i="修改優惠券失敗٩(ŏ﹏ŏ、)۶"),this.$http[p](t,{data:r}).then(s=>{this.isLoading=!1,this.getCoupons(),this.$refs.couponModal.hideModal(),u.fire({position:"top-end",icon:"success",title:e,showConfirmButton:!1,timer:1500,toast:!0})}).catch(()=>{this.isLoading=!1,u.fire({position:"top-end",icon:"error",title:i,showConfirmButton:!1,timer:1e3,toast:!0})})},delCoupon(){this.isLoading=!0,this.$http.delete(`${f}/api/${b}/admin/coupon/${this.tempCoupon.id}`).then(n=>{this.isLoading=!1,this.$refs.delModal.hideModal(),this.getCoupons(),u.fire({position:"top-end",icon:"success",title:"刪除優惠券成功d(`･∀･)b",showConfirmButton:!1,timer:1500,toast:!0})}).catch(()=>{this.isLoading=!1,u.fire({position:"top-end",icon:"error",title:"刪除優惠券失敗٩(ŏ﹏ŏ、)۶",showConfirmButton:!1,timer:1e3,toast:!0})})}},mounted(){this.getCoupons()}},M=n=>(N("data-v-392b9cdd"),n=n(),T(),n),ao=M(()=>o("div",{id:"load"},[o("div",null,"G"),o("div",null,"N"),o("div",null,"I"),o("div",null,"D"),o("div",null,"A"),o("div",null,"O"),o("div",null,"L")],-1)),po={class:"text-end mt-4"},uo={class:"table mt-4"},co=M(()=>o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1)),ro={key:0,class:"text-success"},mo={key:1,class:"text-muted"},_o={class:"btn-group"},ho=["onClick"],fo=["onClick"],bo={class:"d-flex justify-content-center"};function Co(n,t,p,r,e,i){const s=h("AppLoading"),y=h("Pagination"),w=h("CouponModal"),L=h("DelModal");return d(),a(v,null,[o("div",null,[_(s,{active:e.isLoading,"onUpdate:active":t[0]||(t[0]=l=>e.isLoading=l)},{default:V(()=>[ao]),_:1},8,["active"])]),o("div",null,[o("div",po,[o("button",{class:"btn btn-primary",type:"button",onClick:t[1]||(t[1]=l=>i.openCouponModal(!0))}," 建立新的優惠券 ")]),o("table",uo,[co,o("tbody",null,[(d(!0),a(v,null,B(e.coupons,(l,k)=>(d(),a("tr",{key:k},[o("td",null,C(l.title),1),o("td",null,C(l.percent)+"%",1),o("td",null,C(n.$filters.date(l.due_date)),1),o("td",null,[l.is_enabled===1?(d(),a("span",ro,"啟用")):(d(),a("span",mo,"未啟用"))]),o("td",null,[o("div",_o,[o("button",{class:"btn btn-outline-primary btn-sm",onClick:x=>i.openCouponModal(!1,l)},"編輯",8,ho),o("button",{class:"btn btn-outline-danger btn-sm",onClick:x=>i.openDelCouponModal(l)},"刪除",8,fo)])])]))),128))])]),o("div",bo,[_(y,{pages:e.pages,onEmitPages:i.getCoupons},null,8,["pages","onEmitPages"])]),_(w,{coupon:e.tempCoupon,"is-new":e.isNew,ref:"couponModal",onUpdateCoupon:i.updateCoupon},null,8,["coupon","is-new","onUpdateCoupon"]),_(L,{item:e.tempCoupon,ref:"delModal",onDelItem:i.delCoupon},null,8,["item","onDelItem"])])],64)}const wo=g(lo,[["render",Co],["__scopeId","data-v-392b9cdd"]]);export{wo as default};
