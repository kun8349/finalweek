import{S as u}from"./sweetalert2.all-ad3517e2.js";import{m as w,D as I}from"./DelModal-d6a073cd.js";import{_ as y,o as d,c as l,b as t,t as s,k as L,F as h,j as b,A as v,X as k,d as p,w as S,r as _,n as D,p as U,f as E}from"./index-d9a35d42.js";import{P as V}from"./PaginationView-9856bd91.js";const B={props:{productOrder:{type:Object,default(){return{}}}},data(){return{tempProduct:{}}},mixins:[w],emits:["update-order-status"],watch:{productOrder(){this.tempProduct=this.$props.productOrder}}},A={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},T={class:"modal-dialog modal-xl"},j={class:"modal-content"},N=t("div",{class:"modal-header bg-secondary text-black"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"訂單細節"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),R={class:"modal-body"},F={class:"row"},H={class:"col-4"},q=t("h2",null,"用戶資料",-1),z={class:"table mt-2"},G={key:0},X=t("th",{style:{width:"100px"}},"姓名",-1),J=t("th",null,"email",-1),K=t("th",null,"電話",-1),Q=t("th",null,"地址",-1),W={class:"col-8"},Y=t("h2",null,"訂單細節",-1),Z={class:"table mt-2"},tt=t("th",{style:{width:"100px"}},"訂單編號",-1),et=t("th",null,"下單時間",-1),ot=t("th",null,"付款時間",-1),st={key:0},nt={key:1},dt=t("th",null,"付款狀態",-1),lt={key:0,class:"text-success"},it={key:1},rt=t("th",null,"總金額",-1),at=t("h2",null,"選購商品",-1),ct={class:"table mt-2"},ut={class:"text-end"},pt={class:"form-check d-flex justify-content-end"},_t={class:"form-check-label",for:"flexCheckIndeterminate"},ht={key:0},mt={key:1},ft={class:"modal-footer"},bt=t("button",{type:"button",class:"btn btn-outline-textSecondary","data-bs-dismiss":"modal"},"取消",-1);function gt(o,i,g,P,e,a){return d(),l("div",A,[t("div",T,[t("div",j,[N,t("div",R,[t("div",F,[t("div",H,[q,t("table",z,[e.tempProduct.user?(d(),l("tbody",G,[t("tr",null,[X,t("td",null,s(e.tempProduct.user.name),1)]),t("tr",null,[J,t("td",null,s(e.tempProduct.user.email),1)]),t("tr",null,[K,t("td",null,s(e.tempProduct.user.tel),1)]),t("tr",null,[Q,t("td",null,s(e.tempProduct.user.address),1)])])):L("",!0)])]),t("div",W,[Y,t("table",Z,[t("tbody",null,[t("tr",null,[tt,t("td",null,s(e.tempProduct.id),1)]),t("tr",null,[et,t("td",null,s(o.$filters.date(e.tempProduct.create_at)),1)]),t("tr",null,[ot,t("td",null,[e.tempProduct.paid_date?(d(),l("span",st,s(e.tempProduct.paid_date),1)):(d(),l("span",nt,"時間不正確"))])]),t("tr",null,[dt,t("td",null,[e.tempProduct.is_paid?(d(),l("span",lt," 完成付款 ")):(d(),l("span",it,"尚未付款"))])]),t("tr",null,[rt,t("td",null,"$"+s(e.tempProduct.total),1)])])]),at,t("table",ct,[t("tbody",null,[(d(!0),l(h,null,b(e.tempProduct.products,r=>(d(),l("tr",{key:r.id+"訂單產品"},[t("th",null,s(r.product.title),1),t("td",null,s(r.product.num)+" / "+s(r.product.unit),1),t("td",ut,"$"+s(r.total),1)]))),128))])])]),t("div",pt,[v(t("input",{class:"form-check-input",type:"checkbox",id:"flexCheckIndeterminate","onUpdate:modelValue":i[0]||(i[0]=r=>e.tempProduct.is_paid=r)},null,512),[[k,e.tempProduct.is_paid]]),t("label",_t,[e.tempProduct.is_paid?(d(),l("span",ht,"完成付款")):(d(),l("span",mt,"未付款"))])])])]),t("div",ft,[bt,t("button",{type:"button",class:"btn btn-primary",onClick:i[1]||(i[1]=()=>o.$emit("update-order-status",e.tempProduct))}," 修改付款狀態 ")])])])],512)}const yt=y(B,[["render",gt]]);const{VITE_URL:m,VITE_PATH:f}={VITE_URL:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"kevin-jiang",BASE_URL:"/finalweek/",MODE:"production",DEV:!1,PROD:!0},vt={data(){return{orders:{},tempOrder:{},isLoading:!1,isUpdatingLoading:!1,loadingItem:"",pages:{},currentPage:1}},components:{ModalOrder:yt,Pagination:V,DelModal:I},methods:{getOrders(o=1){this.currentPage=o,this.isUpdatingLoading||(this.isLoading=!0),this.$http.get(`${m}api/${f}/admin/orders/?page=${o}`).then(i=>{this.orders=i.data.orders,this.pages=i.data.pagination,this.isLoading=!1}).catch(()=>{u.fire({position:"top-end",icon:"error",title:"資料取得失敗(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0})})},changeOrderStatus(o){this.isUpdatingLoading=!0;const i={is_paid:o.is_paid};this.loadingItem=o.id,this.$http.put(`${m}api/${f}/admin/order/${o.id}`,{data:i}).then(()=>{this.loadingItem="",u.fire({position:"top-end",icon:"success",title:"訂單修改成功(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0}),this.getOrders(),this.$refs.orderModal.hideModal()}).catch(()=>{u.fire({position:"top-end",icon:"error",title:"訂單修改失敗(｡◕∀◕｡)",showConfirmButton:!1,timer:1e3,toast:!0})})},openModal(o){this.tempOrder={...o},this.$refs.orderModal.openModal()},openDelModal(o){this.tempOrder={...o},this.$refs.delModal.openModal()},delOrder(){this.$http.delete(`${m}api/${f}/admin/order/${this.tempOrder.id}`).then(o=>{this.$refs.delModal.hideModal(),this.getOrders(this.currentPage),u.fire({position:"top-end",icon:"success",title:"成功刪除單一產品d(`･∀･)b",showConfirmButton:!1,timer:1500,toast:!0})}).catch(()=>{u.fire({icon:"success",title:"刪除單一品項失敗٩(ŏ﹏ŏ、)۶",showConfirmButton:!1,timer:1500})})}},mounted(){this.getOrders()}},O=o=>(U("data-v-fea5d933"),o=o(),E(),o),kt=O(()=>t("div",{id:"load"},[t("div",null,"G"),t("div",null,"N"),t("div",null,"I"),t("div",null,"D"),t("div",null,"A"),t("div",null,"O"),t("div",null,"L")],-1)),Ot={class:"table mt-4"},Pt=O(()=>t("thead",null,[t("tr",null,[t("th",{scope:"col"},"購買時間"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"購買款項"),t("th",{scope:"col"},"應付金額"),t("th",{scope:"col"},"是否付款"),t("th",{scope:"col"},"編輯")])],-1)),xt={class:"table-group-divider"},Ct={class:"list-unstyled"},Mt={class:"form-check form-switch"},$t=["id","onUpdate:modelValue","onChange","disabled"],wt=["for"],It={key:0},Lt={key:1},St={class:"btn-group",role:"group","aria-label":"Basic mixed styles example"},Dt=["onClick"],Ut=["onClick"],Et={class:"d-flex justify-content-center"};function Vt(o,i,g,P,e,a){const r=_("AppLoading"),x=_("Pagination"),C=_("ModalOrder"),M=_("DelModal");return d(),l(h,null,[t("div",null,[p(r,{active:e.isLoading,"onUpdate:active":i[0]||(i[0]=n=>e.isLoading=n)},{default:S(()=>[kt]),_:1},8,["active"])]),t("table",Ot,[Pt,t("tbody",xt,[(d(!0),l(h,null,b(e.orders,n=>(d(),l("tr",{key:n.id+"後台訂單列表",class:D({"text-textSecondary":!n.is_paid})},[t("td",null,s(o.$filters.date(n.create_at)),1),t("td",null,s(n.user.email),1),t("td",null,[t("ul",Ct,[(d(!0),l(h,null,b(n.products,(c,$)=>(d(),l("li",{key:$+"訂單"},s(c.product.title)+"數量 : "+s(c.qty)+" "+s(c.product.unit),1))),128))])]),t("td",null,"$"+s(n.total),1),t("td",null,[t("div",Mt,[v(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`orderSwitch${n.id}`,"onUpdate:modelValue":c=>n.is_paid=c,onChange:()=>a.changeOrderStatus(n),disabled:e.loadingItem===n.id},null,40,$t),[[k,n.is_paid]]),t("label",{class:"form-check-label",for:`orderSwitch${n.id}`},[n.is_paid?(d(),l("span",It,"已付款")):(d(),l("span",Lt,"未付款"))],8,wt)])]),t("td",null,[t("div",St,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:()=>a.openModal(n)}," 檢視 ",8,Dt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:()=>a.openDelModal(n)}," 刪除 ",8,Ut)])])],2))),128))])]),t("div",Et,[p(x,{pages:e.pages,onEmitPages:a.getOrders},null,8,["pages","onEmitPages"])]),p(C,{onUpdateOrderStatus:a.changeOrderStatus,"product-order":e.tempOrder,ref:"orderModal"},null,8,["onUpdateOrderStatus","product-order"]),p(M,{item:e.tempOrder,onDelItem:a.delOrder,ref:"delModal"},null,8,["item","onDelItem"])],64)}const Nt=y(vt,[["render",Vt],["__scopeId","data-v-fea5d933"]]);export{Nt as default};
